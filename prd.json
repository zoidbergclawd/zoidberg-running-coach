{
  "project": "Zoidberg's Running Coach",
  "goal": "A CLI tool that analyzes Garmin training data and provides half marathon coaching suggestions",
  "target_user": "Jon McBee - preparing for spring half marathon",
  "tech_stack": {
    "language": "Python 3.11+",
    "garmin": "garth library (Python Garmin Connect client - same as garth-mcp-server uses)",
    "cli": "typer for CLI interface",
    "data": "pandas for analysis",
    "output": "rich for beautiful terminal output"
  },
  "auth_notes": {
    "token_source": "Run 'uvx garth login' to authenticate and get token",
    "env_var": "GARTH_TOKEN - the OAuth token string",
    "persistence": "Token is saved to ~/.garth by garth library"
  },
  "items": [
    {
      "id": 1,
      "category": "setup",
      "title": "Project Scaffold",
      "description": "Project scaffolding with pyproject.toml, dependencies, and basic structure",
      "steps": [
        "Create pyproject.toml with dependencies: garth, typer, pandas, rich",
        "Create src/zoidberg_coach/ package structure",
        "Create src/zoidberg_coach/__init__.py with version",
        "Create src/zoidberg_coach/__main__.py that calls CLI",
        "Create src/zoidberg_coach/cli.py with typer app and --help",
        "Verify: pip install -e . && zoidberg-coach --help shows usage"
      ],
      "priority": 1,
      "passes": true,
      "verification": "pip install -e . && zoidberg-coach --help",
      "can_verify_without_token": true
    },
    {
      "id": 2,
      "category": "integration",
      "title": "Garmin Client & Activities",
      "description": "Connect to Garmin via garth library and fetch activities",
      "steps": [
        "Create src/zoidberg_coach/garmin_client.py",
        "Implement GarminClient class that initializes garth connection",
        "Handle auth: check for ~/.garth token OR GARTH_TOKEN env var",
        "Implement get_activities(days=30) using garth.connectapi",
        "Return list of activity dicts with: id, name, type, date, distance, duration",
        "Add CLI command: zoidberg-coach activities --days 30",
        "Verify: Command lists recent activities with distance and pace"
      ],
      "priority": 1,
      "passes": false,
      "verification": "zoidberg-coach activities --days 30",
      "can_verify_without_token": false,
      "garth_api": "garth.connectapi('/activitylist-service/activities/search/activities', params={...})"
    },
    {
      "id": 3,
      "category": "integration",
      "title": "Activity Details",
      "description": "Fetch detailed activity data including splits and heart rate",
      "steps": [
        "Implement get_activity_details(activity_id) in GarminClient",
        "Fetch splits/laps via garth.connectapi('/activity-service/activity/{id}/splits')",
        "Parse each split: distance, duration, avg_hr, avg_pace",
        "Add CLI command: zoidberg-coach activity <id>",
        "Verify: Command shows lap-by-lap breakdown with pace and HR"
      ],
      "priority": 1,
      "passes": false,
      "verification": "zoidberg-coach activity <id>",
      "can_verify_without_token": false
    },
    {
      "id": 4,
      "category": "integration",
      "title": "Recovery Metrics",
      "description": "Fetch recovery metrics using garth data classes",
      "steps": [
        "Implement get_sleep(date) using garth.DailySleep.get(date)",
        "Implement get_hrv(date) using garth.DailyHRV.get(date) or HRVData.get()",
        "Implement get_body_battery(date) using garth.DailyBodyBattery.get(date)",
        "Implement get_stress(date) using garth.DailyStress.get(date)",
        "Add CLI command: zoidberg-coach recovery [--date YYYY-MM-DD]",
        "Verify: Command shows sleep score, HRV, body battery, stress for a date"
      ],
      "priority": 2,
      "passes": false,
      "verification": "zoidberg-coach recovery",
      "can_verify_without_token": false,
      "garth_classes": [
        "DailySleep",
        "DailyHRV",
        "HRVData",
        "DailyBodyBattery",
        "DailyStress"
      ]
    },
    {
      "id": 5,
      "category": "analysis",
      "title": "Weekly Summary",
      "description": "Calculate weekly training load metrics",
      "steps": [
        "Create src/zoidberg_coach/analysis.py",
        "Implement weekly_summary(activities) returning dict per week: total_miles, total_time, run_count",
        "Implement training_load_trend(weekly_summaries) checking 10% rule",
        "Flag weeks with >10% mileage increase as potential overload",
        "Add CLI command: zoidberg-coach summary --weeks 8",
        "Verify: Shows weekly mileage progression with trend indicators"
      ],
      "priority": 2,
      "passes": false,
      "verification": "zoidberg-coach summary --weeks 8",
      "can_verify_without_token": false
    },
    {
      "id": 6,
      "category": "analysis",
      "title": "Polarization Analysis",
      "description": "Implement 80/20 polarized training analysis",
      "steps": [
        "Get user's HR zones from garth.UserSettings or calculate from max HR",
        "For each activity, calculate time in Zone 1-2 vs Zone 3+",
        "Aggregate across recent weeks to get polarization ratio",
        "Add CLI command: zoidberg-coach polarization --weeks 4",
        "Verify: Shows % easy vs % hard with recommendation if ratio is off"
      ],
      "priority": 2,
      "passes": false,
      "verification": "zoidberg-coach polarization --weeks 4",
      "can_verify_without_token": false
    },
    {
      "id": 7,
      "category": "analysis",
      "title": "Readiness Scoring",
      "description": "Recovery readiness scoring",
      "steps": [
        "Create src/zoidberg_coach/coaching.py",
        "Implement readiness_score(sleep, hrv, body_battery, recent_load) -> 0-100",
        "Weight factors: sleep quality (30%), HRV vs baseline (30%), body battery (20%), fatigue (20%)",
        "Add interpretation: <50 = rest, 50-70 = easy only, 70-85 = normal, 85+ = ready for hard effort",
        "Verify: readiness_score function works with sample data"
      ],
      "priority": 3,
      "passes": false,
      "verification": "pytest tests/test_readiness.py",
      "can_verify_without_token": true,
      "note": "Can unit test scoring logic with mock data"
    },
    {
      "id": 8,
      "category": "coaching",
      "title": "Daily Workout Suggestions",
      "description": "Generate daily workout suggestions",
      "steps": [
        "Implement suggest_workout(readiness, days_since_hard, days_until_race, weekly_mileage)",
        "Logic: if readiness < 50 -> rest; if days_since_hard > 3 and readiness > 70 -> tempo/intervals",
        "Include suggested duration and intensity based on current fitness",
        "Add CLI command: zoidberg-coach today [--race-date YYYY-MM-DD]",
        "Verify: Command shows today's readiness + workout suggestion"
      ],
      "priority": 3,
      "passes": false,
      "verification": "zoidberg-coach today",
      "can_verify_without_token": false
    },
    {
      "id": 9,
      "category": "coaching",
      "title": "Race Readiness",
      "description": "Half marathon race readiness assessment",
      "steps": [
        "Implement race_readiness(activities, target_date, goal_time)",
        "Check: longest run >= 10 miles, weekly mileage consistent, recent tempo paces",
        "Predict finish time using Riegel formula from recent race/time trial",
        "Identify gaps: 'Need more long runs', 'Mileage too low', etc.",
        "Add CLI command: zoidberg-coach race-prep --date YYYY-MM-DD --goal HH:MM:SS",
        "Verify: Shows readiness assessment with specific recommendations"
      ],
      "priority": 3,
      "passes": false,
      "verification": "zoidberg-coach race-prep",
      "can_verify_without_token": false
    },
    {
      "id": 10,
      "category": "polish",
      "title": "Rich UI Polish",
      "description": "Polish CLI output with rich formatting",
      "steps": [
        "Use rich.table.Table for tabular data (activities, weekly summaries)",
        "Use rich.panel.Panel for readiness scores and recommendations",
        "Add colors: green for good metrics, yellow for warning, red for concern",
        "Add progress bars for metrics like polarization ratio",
        "Ensure all commands have consistent, beautiful output",
        "Verify: All commands produce readable, colorful terminal output"
      ],
      "priority": 4,
      "passes": false,
      "verification": "manual check of output",
      "can_verify_without_token": true
    },
    {
      "id": 11,
      "category": "analysis",
      "title": "Pattern Detection",
      "description": "Pattern detection and inference engine",
      "steps": [
        "Create src/zoidberg_coach/patterns.py",
        "Implement correlate_sleep_performance() - does sleep quality predict good runs?",
        "Implement detect_overtraining_signals() - HRV declining + fatigue + performance drop",
        "Implement find_optimal_conditions() - what conditions lead to best performances?",
        "Implement weekly_pattern_report() returning list of insights as strings",
        "Look for: day-of-week patterns, time-of-day patterns, recovery-to-performance correlations",
        "Add CLI command: zoidberg-coach patterns --weeks 8",
        "Verify: Shows 3-5 actionable insights based on historical data"
      ],
      "priority": 3,
      "passes": false,
      "verification": "zoidberg-coach patterns --weeks 8",
      "can_verify_without_token": false,
      "example_insights": [
        "Your best runs happen after 7+ hours of sleep (avg pace 8:15 vs 8:45)",
        "Tuesday/Thursday hard efforts correlate with lower HRV on Wednesdays",
        "Long runs over 8 miles tend to suppress your HRV for 48-72 hours",
        "Body battery below 40 predicts a subpar workout 80% of the time"
      ]
    },
    {
      "id": 12,
      "category": "coaching",
      "title": "Daily Report API",
      "description": "Daily coaching report for Zoidberg cron job",
      "steps": [
        "Create generate_daily_report() returning structured dict with all coaching data",
        "Include: readiness_score, todays_suggestion, recent_load_summary, pattern_insights, race_countdown",
        "Add --format json option to relevant CLI commands for programmatic access",
        "Add CLI command: zoidberg-coach daily-report --race-date YYYY-MM-DD --json",
        "Output should be parseable so Zoidberg can craft personalized Slack messages",
        "Verify: Command outputs complete JSON with all coaching context"
      ],
      "priority": 4,
      "passes": false,
      "verification": "zoidberg-coach daily-report --json",
      "can_verify_without_token": false,
      "note": "This is what Zoidberg will call daily to generate coaching messages for Jon"
    }
  ],
  "quality_expectations": {
    "type_hints": "All functions must have type hints",
    "error_handling": "Graceful handling when not authenticated - show helpful message",
    "documentation": "Docstrings on all public functions",
    "testing": "Not required for v1, but structure code to be testable"
  },
  "stop_condition": "All items have passes: true and CLI demonstrates end-to-end workflow",
  "ralph_notes": {
    "without_token": "Items 1, 7, 10 can be completed without Garmin auth. Start there if token unavailable.",
    "api_exploration": "Use garth library docs and source code to understand available endpoints",
    "incremental_commits": "Commit after each working feature, even if not fully polished"
  }
}
